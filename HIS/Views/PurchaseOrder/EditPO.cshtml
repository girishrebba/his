@model List<HIS.PurchaseOrder>
@{
    Layout = null;
}
<style>
    .ui-widget-content a {
        color: #fff !important
    }

    .table > thead > tr > th {
        text-transform: none;
        font-weight: bold;
    }

    .ui-dialog {
        top: 60px !important;
    }
</style>
@using HIS.HtmlHelpers
@using (Html.BeginForm("EditPO", "PurchaseOrder", FormMethod.Post, new { id = "editPOForm", onsubmit = "return SubmitAdjustPoForm(this)" }))
{
    @Html.HiddenFor(model => model[0].PONumber, new {@id = "PONumber" })
    @Html.HiddenFor(model => model[0].OrderedDate, new {@id = "OrderedDate" })
    <div class="form-horizontal">
        <div class="col-lg-8">
            <div class="form-group">
                @Html.LabelFor(model => model[0].PONumber, "PO#:", new { @class = "control-label col-md-2" })
                <div class="col-sm-4 lableDisplay">
                    @Html.DisplayFor(model => model[0].PONumber, new { htmlAttributes = new { @class = "form-control" } })
                </div>
                @Html.LabelFor(model => model[0].OrderDateDisplay, "Order Date:", new { @class = "control-label col-md-2" })
                <div class="col-sm-4 lableDisplay">
                    @Html.DisplayFor(model => model[0].OrderDateDisplay, new { htmlAttributes = new { @class = "form-control" } })
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-12">
                <div class="table-responsive">
                    <table class="table table-striped table-bordered" id="poTable">
                        <thead>
                            <tr>
                                <th style="width:35%">Medicine</th>
                                <th style="width:8%">Order Qty</th>
                                <th style="width:10%">Item(Rs)</th>
                                <th style="width:10%">Sheet(Rs)</th>
                                <th style="width:11%">Batch#</th>
                                <th style="width:11%">Lot#</th>
                                <th style="width:15%">Expiry Date</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (PurchaseOrder p in Model)
                            {
                            <tr>
                                <td style="display:none">@p.OrderID</td>
                                <td style="display:none">@p.MedicineID</td>
                                <td>@p.MedicineWithDose</td>
                                <td>@Html.EditorFor(model => p.OrderedQty, new { htmlAttributes = new { @class = "form-control orderedQty" } })</td>
                                <td>@Html.EditorFor(model => p.PricePerItem, new { htmlAttributes = new { @class = "form-control pricePerItem" } })</td>
                                <td>@Html.EditorFor(model => p.PricePerSheet, new { htmlAttributes = new { @class = "form-control pricePerSheet" } })</td>
                                <td>@Html.EditorFor(model => p.BatchNo, new { htmlAttributes = new { @class = "form-control batchNo" } })</td>
                                <td>@Html.EditorFor(model => p.LotNo, new { htmlAttributes = new { @class = "form-control lotNo" } })</td>
                                <td>
                                    <div id="date-popup" class="input-group date">
                                        @Html.EditorFor(model => p.ExpiryDate, new { htmlAttributes = new { Value = Html.DateFormat(p.ExpiryDate), @class = "datepicker form-control", @placeholder = "" } })
                                        <span class="btnexpirypicker input-group-addon"><i class="fa fa-calendar"></i></span>
                                    </div>
                                </td>
                            </tr>
                            }
                        </tbody>
                        <tfoot>
                            <tr>
                                <td align="right">Total:</td>
                                <td align="left" id="grandQuantity">@Model.Sum(i => i.OrderedQty)</td>
                                <td align="left" id="grandItemPrice">@Model.Sum(i => i.PricePerItem)</td>
                                <td colspan="4" align="left" id="grandSheetPrice">@Model.Sum(i => i.PricePerSheet)</td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </div>
            <div class="row">
                <div class="form-group">
                    <div class="col-md-3 col-md-offset-5">
                        <input type="submit" value="Update" id="btnSubmit" class="btn btn-primary" />
                        <input type="button" value="Delete Order" id="btnDelete" class="btn btn-danger" />
                    </div>
                </div>
            </div>
        </div>
    </div>
}
<script type="text/javascript">
    $('.datepicker').datepicker({
        keyboardNavigation: false,
        forceParse: false,
        todayHighlight: true,
        todayBtn: false,
        format: "mm/dd/yyyy"
    });

    $('.btnexpirypicker').click(function () {
        var id = $(this).closest('tr').find('.datepicker');
        $(id).datepicker('show');
    });

    // Quantity
    $(".orderedQty").on('change keyup paste mouseup', function () {
        var qtySum = 0;
        $('.orderedQty').each(function () {
            qtySum += parseFloat($(this).val());
        });
        $('#grandQuantity').html(qtySum);
    });

    // Item Price
    $(".pricePerItem").on('change keyup paste mouseup', function () {
        var itemSum = 0;
        $('.pricePerItem').each(function () {
            itemSum += parseFloat($(this).val());
        });
        $('#grandItemPrice').html(itemSum.toFixed(2));
    });

    // Sheet Price
    $(".pricePerSheet").on('change keyup paste mouseup', function () {
        var sheetSum = 0;
        $('.pricePerSheet').each(function () {
            sheetSum += parseFloat($(this).val());
        });
        $('#grandSheetPrice').html(sheetSum.toFixed(2));
    });

    $('#btnDelete').click(function () {
        if (confirm('Are You Sure to Delete this Purchase Order?')) {
            $.ajax({
                type: "POST",
                url: '@Url.Action("DeletePO", "PurchaseOrder")',
                data: { 'poNumber': $('#PONumber').val() },
                success: function (data) {
                    if (data.success) {
                        AdjPop.dialog('close');
                        dataTable.ajax.reload();
                        $.notify(data.message, {
                            globalPosition: "top center",
                            className: "success"
                        })
                    }
                }
            });
        }
        return false;
    });

</script>