@model List<HIS.PatientPrescription>
@{
    Layout = null;
}
<style>
    .ui-widget-content a {
        color: #fff !important
    }

    .table > thead > tr > th {
        text-transform: none;
        font-weight: bold;
    }

    .ui-dialog {
        top: 60px !important;
    }
</style>
@using HIS.HtmlHelpers
@using (Html.BeginForm("DeliverPrescription", "OutPatient", FormMethod.Post, new { id = "dpForm", onsubmit = "return SubmitDeliverPrescriptionForm(this)" }))
{
<div class="form-horizontal">
   
        @Html.HiddenFor(model => model[0].ENMRNO, new { @id = "ENMRNO" })
        @Html.HiddenFor(model => model[0].VisitID, new { @id = "VisitID" })
        <div class="col-lg-8">
            <div class="form-group">
                @Html.LabelFor(model => model[0].ENMRNO, "ENMRNO:", new { @class = "control-label col-md-2" })
                <div class="col-sm-4 lableDisplay">
                    @Html.DisplayFor(model => model[0].ENMRNO, new { htmlAttributes = new { @class = "form-control" } })
                </div>
                @Html.LabelFor(model => model[0].VisitName, "Visit:", new { @class = "control-label col-md-2" })
                <div class="col-sm-4 lableDisplay">
                    @Html.DisplayFor(model => model[0].VisitName, new { htmlAttributes = new { @class = "form-control" } })
                </div>
            </div>
            <div class="form-group">
                @Html.LabelFor(model => model[0].DoctorName, "Doctor:", new { @class = "control-label col-md-2" })
                <div class="col-sm-4 lableDisplay">
                    @Html.DisplayFor(model => model[0].DoctorName, new { htmlAttributes = new { @class = "form-control" } })
                </div>
                @Html.LabelFor(model => model[0].DateDisplay, "Date:", new { @class = "control-label col-md-2" })
                <div class="col-sm-4 lableDisplay">
                    @Html.DisplayFor(model => model[0].DateDisplay, new { htmlAttributes = new { @class = "form-control" } })
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-12">
                <div class="table-responsive">
                    <table class="table table-striped table-bordered" id="ppTable">
                        <thead>
                            <tr>
                                <th style="width:27%">Medicine</th>
                                <th style="width:6%">Quantity</th>
                                <th style="width:6%">Delivered</th>
                                <th style="width:5%">Price</th>
                                <th style="width:17%">Intake</th>
                                <th style="width:25%">Comments</th>
                                <th style="width:7%">Batch</th>
                                <th style="width:7%">Lot</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var p in Model)
                            {
                                <tr>
                                    <td style="display:none">@p.ItemCost</td>
                                    <td style="display:none">@p.MedicineID</td>
                                    <td>@p.MedicineWithDose</td>
                                    <td>@p.Quantity</td>
                                    <td>@Html.EditorFor(model => p.DeliverQty, new { htmlAttributes = new { @class = "form-control deliverQty" } })</td>
                                    <td class="price">@p.TotalCost</td>
                                    <td>@p.IntakeDisplay</td>
                                    <td>@p.Comments</td>
                                    <td>@Html.EditorFor(model => p.BatchNo, new { htmlAttributes = new { @class = "form-control batchNo" } })</td>
                                    <td>@Html.EditorFor(model => p.LotNo, new { htmlAttributes = new { @class = "form-control lotNo" } })</td>
                                </tr>
                            }
                        </tbody>
                        <tfoot>
                            <tr>
                                <td colspan="3" align="right">Total:</td>
                                <td colspan="5" align="left" id="grandTotal">@Model.Sum(i => i.TotalCost)</td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </div>
            <div class="row">
                <div class="form-group">
                    <div class="col-md-3 col-md-offset-5">
                        <input type="submit" value="Deliver & Print" id="btnSubmit" class="btn btn-primary" />
                    </div>
                </div>
            </div>
        </div>
</div>    
}

            <script type="text/javascript">
                $(".deliverQty").on('change keyup paste mouseup', function () {
                    var itemPrice = $(this).closest('tr').find('td:eq(0)').html();
                    var totalPrice = $(this).val() * itemPrice;
                    $(this).closest('tr').find('td:eq(5)').html(totalPrice.toFixed(2));
                    var sum = 0;
                    $('.price').each(function () {
                        sum += parseFloat($(this).text());
                    });
                    $('#grandTotal').html(sum.toFixed(2))

                });
            </script>
